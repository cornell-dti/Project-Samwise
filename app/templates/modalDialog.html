<script type='text/javascript'>
	$(document).ready(function() {

        // page is now ready, initialize the calendar...

        var intromodal = document.getElementById('introModal');
				var modal = document.getElementById('myModal');
				var modalevent = document.getElementById('eventModal');
        var desktopmodal = document.getElementById('desktopModal');

        var spanintro = document.getElementsByClassName('close')[0];
        var span = document.getElementsByClassName('close')[1];
        var span2 = document.getElementsByClassName('close')[2];
        var spandesktop = document.getElementsByClassName('close')[3];
        var spanproject = document.getElementsByClassName('close')[4];
        var spantask = document.getElementsByClassName('close')[5];


        var courseAddButton = document.getElementById('courseAdd');
        var eventAddButton = document.getElementById('eventAdd');
        var input = document.getElementById("nameOne");
        var awesomplete = new Awesomplete(input, {
				  minChars: 1,
				  autoFirst: true
				});

        // When the user clicks on <span> (x), close the modal
        eventAddButton.onclick = function() {
        	modalevent.style.display = 'none';
        }
        spanintro.onclick = function() {
            intromodal.style.display = 'none';
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = 'none';
        }

        span2.onclick = function() {
        	modalevent.style.display = 'none';
        }

        spandesktop.onclick = function() {
            desktopmodal.style.display = 'none';
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }

            if (event.target == modalevent) {
            	modalevent.style.display = 'none';
            }

            if (event.target == intromodal) {
                intromodal.style.display = 'none';
            }

            if (event.target == desktopmodal) {
                desktopmodal.style.display = 'none';
            }
        }

        {% if netid %}
        	var dataurl = 'http://localhost:5000/cal/' + '{{ netid }}' + '/getExams';
			$("#calendar").fullCalendar('addEventSource', {url: dataurl});
		{% endif %}

		var events = JSON.parse(localStorage.getItem("events")) == null ? [] : JSON.parse(localStorage.getItem("events"));
		for (var i = 0; i < events.length; i++) {
			var eventTitle = events[i];
			$("#calendar").fullCalendar('addEventSource', {url: 'http://localhost:5000/exams/' + eventTitle});
            $("#calendar").fullCalendar('addEventSource', {url: 'http://localhost:5000/courses/' + eventTitle});
            $('#calendar').fullCalendar('prev');
			$('#calendar').fullCalendar('next');
		}

		var renderedDays = [];


        $('#calendar').fullCalendar({

			header: {
				right: 'prev,next,today',
				center: 'month,agendaWeek,agendaDay'
			},

			eventColor: "rgba(0, 0, 0, 0)",
			eventTextColor: "rgba(0, 0, 0, 0)",


			eventAfterAllRender: function(view) {
		        renderedDays = getDates($('#calendar').fullCalendar('getView').start, $('#calendar').fullCalendar('getView').end);


		        $('#calendar').fullCalendar('clientEvents', function(event) {

		          var result = $.grep(renderedDays, function(e) {
		            return e.id == event.start.format('YYYY-MM-DD');
		          });
		          if (result.length > 0) {
		            result[0].events += 1;
		          }
		        });

		        $.each(renderedDays, function(index, value) {
		        	var td = $('td.fc-day[data-date="' + value.id + '"]');
		          if (value.events > 0 && value.events < 2) {
		            td.css("background-color", "#fbf4ad");
		          }
		          else if (value.events >= 2 && value.events < 4) {
		            td.css("background-color", "#fdb373");
		          }
		          else if (value.events >= 4 && value.events < 6) {
		            td.css("background-color", "#f67b8a");
		          }
		          else if (value.events >= 6) {
		          	td.css("background-color", "#f7485f");
		          }

		          td.addClass('pointer');

		        });
		      },

		    eventClick: function(calEvent) {

        		var ul = document.getElementById("dayEvents");
                while (ul.hasChildNodes()) {
                	ul.removeChild(ul.lastChild);
                }

                $('#calendar').fullCalendar('clientEvents', function(event) {
					if(moment(calEvent._start).format('YYYY-MM-DD')==moment(event._start).format('YYYY-MM-DD')) {
						var li = document.createElement("li");
						li.appendChild(document.createTextNode(moment(event._start).format('hh:mma') + " " + event.title));
						ul.appendChild(li);
					}
				});

       		 return false;
    		},

    		dayRender: function( date, cell ) {
    			cell.addClass('pointer');
    		},

            // put your options and callbacks here
            dayClick: function(date) {

                // modal.style.display = "block";


				var ul = document.getElementById("dayEvents");
                while (ul.hasChildNodes()) {
                	ul.removeChild(ul.lastChild);
                }

                $('#calendar').fullCalendar('clientEvents', function(event) {
					if(moment(date).format('YYYY-MM-DD')==moment(event._start).format('YYYY-MM-DD')) {
						// console.log(event.title);
						var li = document.createElement("li");
						li.appendChild(document.createTextNode(moment(event._start).format('hh:mma') + " " + event.title));
						ul.appendChild(li);
					}
				});

            }
        });

        function getDates(startDate, endDate) {
		  var now = startDate,
		    dates = [];

		  while (now.format('YYYY-MM-DD') <= endDate.format('YYYY-MM-DD')) {
		    dates.push({
		      id: now.format('YYYY-MM-DD'),
		      events: 0
		    });
		    now.add('days', 1);
		  }
		  return dates;
		};


    });

    document.addEventListener('DOMContentLoaded', function () {
      if (Notification.permission !== "granted")
        Notification.requestPermission();
    });

    function sendEmail() {
    	window.open('mailto:kl553@cornell.edu?subject=SA%20Tech%20Email%20Notification');
    }

    function notifyMe() {


      if (!Notification) {
        alert('Desktop notifications not available in your browser. Try Chromium.');
        return;
      }

      if (Notification.permission !== "granted")
        Notification.requestPermission();
      else {
        var notification = new Notification('Notification title', {
          icon: 'https://avatars1.githubusercontent.com/u/19356609?v=3&s=200',
          body: "Hey there! You've been notified!",
        });

        notification.onclick = function () {
          window.open("http://www.cornelldti.org/");
        };

      }

    }

    function introAdd() {
        var modal = document.getElementById('introModal');
        modal.style.display = 'block';
    }

		function addClassModal() {
			var modal = document.getElementById('addClassModal');
			modal.style.display = 'block';
		}

    function addingClass() {
        var modal = document.getElementById('eventModal');
        modal.style.display = 'block';
    }

    function switchClass() {
        var modal = document.getElementById('introModal');
        modal.style.display = 'none';
        var modal2 = document.getElementById('eventModal');
        modal2.style.display = 'block';
    }

    function switchCouse() {
        var modal = document.getElementById('introModal');
        modal.style.display = 'none';
        var modal2 = document.getElementById('myModal');
        modal2.style.display = 'block';

		$.getJSON('http://localhost:5000/getAllClasses', function(data) {
		  //data is the JSON string
		  awesomplete.list = data;
		});
    }

    function desktopToggle() {
        var modal = document.getElementById('desktopModal');
        modal.style.display = 'block';
    }


    function eventToggle() {
        var modal = document.getElementById('eventModal');
        modal.style.display = 'block';
    }

    function goButton(modalType) {
    	var modal = document.getElementById(modalType);
    	modal.style.display = 'none';
    }



</script>

<div id = "addClassModal" class="modal" style= "display:none;">
	
</div>

<div id="introModal" class="modal" style= "display:block;">

		      <!-- Modal content -->
		      <div class="modal-content">
			<div class="modal-header" style="background-color: #4a4a4a;" >
			<span class="close">&times;</span>
			  <h2>Welcome</h2>

			  <div class="col-sm-8">
					<h4>Integrate With Google Calendar</h3>

					<p><button class="w3-button w3-grey w3-round-xxlarge" style="color:white;">Login</button></p>

					<h4>Pick classes to get exam dates and auto-suggest course work</h3>

					<div class="col-sm-8">
						<input style="background-color: #4a4a4a;" class= "task_name" type="text" name="classSearch" value="Search Classes at Cornell"> <br>
						<h4>Add extra tags to organize your life</h3>
						<input style="background-color: #4a4a4a;" class= "task" type="text" name="tag1" value="CS 1112"> <br>
						<input style="background-color: #4a4a4a;" class= "task" type="text" name="tag1" value="CHEM 2090"> <br>
						<input style="background-color: #4a4a4a;" class= "task" type="text" name="tag1" value="SA Tech"> <br>
						<p>+ New Tag</p>
					</div>

					<div class="col-sm-4">

					</div>
				</div>

				<div class="col-sm-4">
					<br>
					<br>
					<br>
					<br>
					<br>
					<br>
					<br>
					<br>
					<br>
					<br>
					<br>
					<br>
					<br>
					<button class="w3-button w3-green w3-round-xxlarge" style="float:right;" onclick="goButton('introModal')">Let's Go</button>
				</div>


			</div>

		      </div>

		    </div>

<div id="myModal" class="modal">

			    <!-- Modal content -->
			    <div class="modal-content">
						<div class="modal-header">
								<span class="close">&times;</span>
								<h2>Course Search</h2>
						</div>
						<div class="modal-body">

				    <!-- <form name="form1" method="post" id="newGame"> -->
						<fieldset>
				        	<label for="Name">Course Name:</label>
				        	<input id="nameOne" type="text" />
				    	</fieldset>
				    	<fieldset class="noHeight">
	        				<input id="addClass" class="submit" type="submit" onclick="myFunction()" />
	    				</fieldset>
				    <!-- </form> -->

						</div>
		      </div>
</div>

<div id="eventModal" class="modal">

		      <!-- Modal content -->
		      <div class="modal-content">
			<div class="modal-header">
			  <span class="close">&times;</span>
			  <h2>Event Search</h2>
			</div>
			<div class="modal-body">

			    <form name="form2" method="post" id="newGame">
				<p id="userInput">
				  <label>Event Name:</label>
				  <br />
				  <input class= "task" type="text" name="event1" placeholder="Enter Event Name">
				  <br />
				</p>
				<br />
			    </form>
			    <button class="w3-button w3-green w3-round-xxlarge" id="eventAdd" onclick="javascript:addEvent()" style="float: right;">Add</button>

			</div>
			<div class="modal-footer">
			  </div>
		      </div>

		    </div>

<div id="desktopModal" class="modal">

		      <!-- Modal content -->
		      <div class="modal-content">
			<div class="modal-header" style="background-color: #4a4a4a;">
			  <span class="close">&times;</span>
			  <h2>Notification Settings</h2>
			</div>
			<div class="modal-body" style="background-color: #4a4a4a;">
				<label>Notify Me For:</label>
				<br />
				<label>Assignments:</label>
				<input class= "task" style="background-color: #4a4a4a;" type="text" name="p1" id="assignmentSettings" type="submit"/>
				<br />
				<label>Projects:</label>
				<input class= "task" style="background-color: #4a4a4a;" type="text" name="p1" id="projectSettings" type="submit"/>
				<br />
				<label>Essays:</label>
				<input class= "task" style="background-color: #4a4a4a;" type="text" name="p1" id="essaySettings" type="submit"/>
				<br />
				<label>Exams:</label>
				<input class= "task" style="background-color: #4a4a4a;" type="text" name="p1" id="examSettings" type="submit"/>
				<br />

				<button class="w3-button w3-purple w3-round-xxlarge" onclick="notifyMe()" style="float: right;">Notify Me</button>
				<button class="w3-button w3-orange w3-round-xxlarge" onclick="sendEmail()" style="float: right;">Send Email</button>

			</div>
			<div class="modal-footer" style="background-color: #4a4a4a;">
			  </div>
		      </div>

		    </div>
